if(null===NE||void 0===NE)var NE={};(null===NE.Plugin||void 0===NE.Plugin)&&(NE.Plugin={}),NE.Plugin.assessment=function(i_params){function _addToDOM(i_content){_params.node.replaceWith(i_content)}function _onComplete(){_adjustButtons(),$("#"+_settings.ID).on("click",".NE-assessment-option-button",function(){_onButtonClick($(this))}),me.OnLoaded()}function _onButtonClick(i_sender){_toggleButtons(i_sender),console.clear();var resultObj=window["NE.AssessmentsResult"]||[],interactionkey=i_sender.data("interactionkey");if(interactionkey){var interactionId=$("#"+interactionkey+"-id").val(),interactionData=($("#"+interactionkey+"-description").val(),i_sender.data("answer")||i_sender.text().trim(),i_sender.data("result")||"unanticipated",parseInt($("#"+interactionkey+"-weighting").val(),10),{id:$("#"+interactionkey+"-id").val(),response:i_sender.data("answer")||i_sender.text().trim(),result:i_sender.data("result")||"unanticipated",weighting:parseInt($("#"+interactionkey+"-weighting").val(),10),description:$("#"+interactionkey+"-description").val()});try{NE.LMS.Interactions.StoreInteraction(interactionData)}catch(e){}var loopIndex,insertAtIndex=resultObj.length;for(loopIndex=0;loopIndex<resultObj.length;loopIndex++)if(resultObj[loopIndex].id===interactionId){insertAtIndex=loopIndex;break}resultObj[insertAtIndex]=interactionData,window["NE.AssessmentsResult"]=resultObj}return _assessmentdata.instantFeedback===!1?void _onAfterOption(i_sender):void _displayFeedback(i_sender,function(){_onAfterOption(i_sender)})}function _onAfterOption(i_sender){_assessmentdata.autoSubmit&&me.OnSubmit(i_sender)}function _toggleButtons(i_sender){$(".NE-assessment-option-button","#"+_settings.ID).removeClass("active"),i_sender.addClass("active")}function _displayFeedback(i_sender,i_callback){var fbId=i_sender.data("fb"),fbArea=$("#"+fbId);if(_openFeedback){if(_openFeedback.attr("id")==fbArea.attr("id"))return;fbArea.parent().css("height",fbArea.parent().outerHeight()+"px"),_openFeedback.fadeOut(300,function(){fbArea.removeClass("hidden").fadeOut(0).fadeIn(300,function(){i_callback&&i_callback()})})}else fbArea.removeClass("hidden").slideUp(0).slideDown(300,function(){NE.Scroll.ToElementY(fbArea,"middle",i_callback)});_openFeedback=fbArea}function _padRow(i_row,i_height){for(var i=0;i<i_row.length;i++){var item=i_row[i],diff=i_height-item.outerHeight();diff>0&&(diff=15+diff/2,item.css({"padding-top":diff+"px","padding-bottom":diff+"px"}))}}function _adjustButtons(){var cnt=0,highst=0,limit=3,row=[],rowCount=0;$(".NE-assessment-option-button","#"+_settings.ID).each(function(){var h=$(this).outerHeight();highst=h>highst?h:highst,row.push($(this)),cnt++==limit-1&&(_padRow(row,highst,rowCount),rowCount++,highst=null,cnt=0,row=[])}),_padRow(row,highst,rowCount)}var _myDOMContent,_openFeedback,_params=i_params,_settings={},_assessmentdata=null,me={Name:"assessment",Dependencies:["assessment.css"],Init:function(){_settings=_params.settings,_settings.datafile?NE.Net.LoadJsonFile(_settings.datafile,function(jsonData){_assessmentdata=jsonData,NE.Plugin.ApplyTemplate(me,function(data){_myDOMContent=$(data.replace(/{assessmentID}/g,_settings.ID)),_addToDOM(_myDOMContent),_onComplete()})}):_onComplete()},Render:function(params){var questionIndex,currentQuestion,optionIndex,currentOption,feedbackIndex,currentFeedback,assessmentId=_assessmentdata.id,returnVal="";for((""!==_assessmentdata.title||""!==_assessmentdata.introContent)&&(returnVal+=params[0].data.replace(/{title}/g,_assessmentdata.title).replace(/{introContent}/g,_assessmentdata.introContent)),questionIndex=0;questionIndex<_assessmentdata.questions.length;questionIndex++){for(currentQuestion=_assessmentdata.questions[questionIndex],(""!==currentQuestion.title||""!==currentQuestion.introContent)&&(returnVal+=params[1].data.replace(/{title}/g,currentQuestion.title).replace(/{introContent}/g,currentQuestion.introContent)),returnVal+=params[2].data,optionIndex=0;optionIndex<currentQuestion.options.length;optionIndex++){currentOption=currentQuestion.options[optionIndex];var optData=params[3].data,classes="";"singleChoice"==currentQuestion.questionType&&(classes+=" toggle"),optData=optData.replace(/{content}/g,currentOption.content),optData=optData.replace(/{answerData}/g,currentOption.answerData),optData=optData.replace(/{feedbackIndex}/g,currentOption.feedbackIndex),optData=optData.replace(/{reportingResult}/g,currentOption.reports),optData=optData.replace(/{optionButtonClasses}/g,classes),returnVal+=optData}for(feedbackIndex=0;feedbackIndex<currentQuestion.feedback.length;feedbackIndex++){currentFeedback=currentQuestion.feedback[feedbackIndex];var fbData=params[4].data;fbData=fbData.replace(/{content}/g,currentFeedback.content),fbData=fbData.replace(/{mood}/g,currentFeedback.mood),fbData=fbData.replace(/{feedbackIndex}/g,feedbackIndex),returnVal+=fbData}returnVal=returnVal.replace(/{reportingWeighting}/g,_assessmentdata.reporting.weighting),returnVal=returnVal.replace(/{reportingId}/g,_assessmentdata.reporting.id),returnVal=returnVal.replace(/{reportingDescription}/g,_assessmentdata.reporting.description),returnVal=returnVal.replace(/{questionIndex}/g,questionIndex),returnVal+=params[5].data}return returnVal=returnVal.replace(/{assessmentId}/g,assessmentId)},OnLoaded:function(){},OnSubmit:function(){},eof:null};return me};