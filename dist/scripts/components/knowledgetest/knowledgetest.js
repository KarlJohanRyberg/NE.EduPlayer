if(null===NE||void 0===NE)var NE={};(null===NE.Plugin||void 0===NE.Plugin)&&(NE.Plugin={}),NE.Plugin.knowledgetest=function(i_params){function _addToDOM(i_content){_params.node.replaceWith(i_content)}function _onComplete(){_adjustButtons(),$("#"+_settings.ID).on("click",".NE-knowledgetest-option-button",function(){_onButtonClick($(this))}),me.OnLoaded()}function _onButtonClick(i_sender){_toggleButtons(i_sender);var resultObj=window["NE.knowledgetestsResult"]||[],interactionkey=i_sender.data("interactionkey");if(interactionkey){var interactionId=$("#"+interactionkey+"-id").val(),interactionData=($("#"+interactionkey+"-description").val(),i_sender.data("answer")||i_sender.text().trim(),i_sender.data("result")||"unanticipated",parseInt($("#"+interactionkey+"-weighting").val(),10),{id:$("#"+interactionkey+"-id").val(),response:i_sender.data("answer")||i_sender.text().trim(),result:i_sender.data("result")||"unanticipated",weighting:parseInt($("#"+interactionkey+"-weighting").val(),10),description:$("#"+interactionkey+"-description").val()});try{NE.LMS.Interactions.StoreInteraction(interactionData)}catch(e){}var loopIndex,insertAtIndex=resultObj.length;for(loopIndex=0;loopIndex<resultObj.length;loopIndex++)if(resultObj[loopIndex].id===interactionId){insertAtIndex=loopIndex;break}resultObj[insertAtIndex]=interactionData,window["NE.knowledgetestsResult"]=resultObj}_displayFeedback(i_sender,function(){_onAfterOption(i_sender)})}function _onAfterOption(i_sender){_knowledgetestdata.autoSubmit&&me.OnSubmit(i_sender)}function _toggleButtons(i_sender){$(".NE-knowledgetest-option-button","#"+_settings.ID).removeClass("active"),i_sender.addClass("active")}function _displayFeedback(i_sender,i_callback){var fbId=i_sender.data("fb"),fbArea=$("#"+fbId);if(_openFeedback){if(_openFeedback.attr("id")==fbArea.attr("id"))return;fbArea.parent().css("height",fbArea.parent().outerHeight()+"px"),_openFeedback.fadeOut(300,function(){fbArea.removeClass("hidden").fadeOut(0).fadeIn(300,function(){i_callback&&i_callback()})})}else fbArea.removeClass("hidden").slideUp(0).slideDown(300,function(){NE.Scroll.ToElementY(fbArea,"middle",i_callback)});_openFeedback=fbArea}function _padRow(i_row,i_height){for(var i=0;i<i_row.length;i++){var item=i_row[i],diff=i_height-item.outerHeight();diff>0&&(diff=15+diff/2,item.css({"padding-top":diff+"px","padding-bottom":diff+"px"}))}}function _adjustButtons(){var cnt=0,highst=0,limit=3,row=[],rowCount=0;$(".NE-knowledgetest-option-button","#"+_settings.ID).each(function(){var h=$(this).outerHeight();highst=h>highst?h:highst,row.push($(this)),cnt++==limit-1&&(_padRow(row,highst,rowCount),rowCount++,highst=null,cnt=0,row=[])}),_padRow(row,highst,rowCount)}var _myDOMContent,_openFeedback,_params=i_params,_settings={},_knowledgetestdata=null,me={Name:"knowledgetest",Dependencies:["knowledgetest.css"],Init:function(){_settings=_params.settings,_settings.datafile?NE.Net.LoadJsonFile(_settings.datafile,function(jsonData){_knowledgetestdata=jsonData,NE.Plugin.ApplyTemplate(me,function(data){_myDOMContent=$(data.replace(/{knowledgetestID}/g,_settings.ID)),_addToDOM(_myDOMContent),_onComplete()})}):_onComplete()},Render:function(params){var questionIndex,currentQuestion,optionIndex,currentOption,feedbackIndex,currentFeedback,fbData,knowledgetestId=_knowledgetestdata.id,returnVal="";for((""!==_knowledgetestdata.title||""!==_knowledgetestdata.introContent)&&(returnVal+=params[0].data.replace(/{title}/g,_knowledgetestdata.title).replace(/{introContent}/g,_knowledgetestdata.introContent)),questionIndex=0;questionIndex<_knowledgetestdata.questions.length;questionIndex++){for(currentQuestion=_knowledgetestdata.questions[questionIndex],(""!==currentQuestion.title||""!==currentQuestion.introContent)&&(returnVal+=params[1].data.replace(/{title}/g,currentQuestion.title).replace(/{introContent}/g,currentQuestion.introContent||"")),returnVal+=params[2].data,optionIndex=0;optionIndex<currentQuestion.options.length;optionIndex++){currentOption=currentQuestion.options[optionIndex];var optData=params[3].data,classes="";if("singleChoice"==currentQuestion.questionType&&(classes+=" toggle"),optData=optData.replace(/{content}/g,currentOption.content),optData=optData.replace(/{answerData}/g,currentOption.answerData||currentOption.content),optData=optData.replace(/{feedbackIndex}/g,currentOption.feedbackIndex),optData=optData.replace(/{reportingResult}/g,currentOption.reports),optData=optData.replace(/{optionButtonClasses}/g,classes),returnVal+=optData,currentOption.feedback)for(feedbackIndex=0;feedbackIndex<currentOption.feedback.length;feedbackIndex++)currentFeedback=currentOption.feedback[feedbackIndex],fbData=params[4].data,fbData=fbData.replace(/{content}/g,currentFeedback.content),fbData=fbData.replace(/{mood}/g,currentFeedback.mood),fbData=fbData.replace(/{feedbackIndex}/g,feedbackIndex),returnVal+=fbData}if(currentQuestion.feedback)for(feedbackIndex=0;feedbackIndex<currentQuestion.feedback.length;feedbackIndex++)currentFeedback=currentQuestion.feedback[feedbackIndex],fbData=params[4].data,fbData=fbData.replace(/{content}/g,currentFeedback.content),fbData=fbData.replace(/{mood}/g,currentFeedback.mood),fbData=fbData.replace(/{feedbackIndex}/g,feedbackIndex),returnVal+=fbData;returnVal=returnVal.replace(/{reportingWeighting}/g,currentQuestion.reporting.weighting),returnVal=returnVal.replace(/{reportingId}/g,currentQuestion.reporting.id),returnVal=returnVal.replace(/{reportingDescription}/g,currentQuestion.reporting.description||currentQuestion.title),returnVal=returnVal.replace(/{questionIndex}/g,questionIndex),returnVal+=params[5].data}return returnVal=returnVal.replace(/{knowledgetestId}/g,knowledgetestId)},OnLoaded:function(){},OnSubmit:function(){},eof:null};return me};