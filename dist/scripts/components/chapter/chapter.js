if(null===NE||void 0===NE)var NE={};(null===NE.Plugin||void 0===NE.Plugin)&&(NE.Plugin={}),NE.Plugin.chapter=function(i_params){function _addToDOM(i_content){_params.node.replaceWith(i_content)}function _pageOnLoad(e){e.chapter==_settings.index&&(me.LoadedPages++,me.LoadedPages==_settings.chapter.pages.length&&me.OnLoaded({guid:NE.CourseTree.chapters[_settings.index].guid,index:_settings.index}))}function _removeDuplicateRanPages(pageList){for(var nums=[],i=0;i<pageList.length;i++)for(var j=0;j<NE.CourseTree.RandomSelectedPages.length;j++)pageList[i]==NE.CourseTree.RandomSelectedPages[j]&&nums.push(i);for(var n=0;n<nums.length;n++)pageList.splice(nums[n]-n,1);return pageList}var _myDOMContent,_params=i_params,_settings={},me={Name:"chapter",LoadedPages:0,Dependencies:["chapter.css"],Init:function(){_settings=_params.settings,NE.Plugin.ApplyTemplate(this,function(data){_myDOMContent=$(data.replace(/{ID}/g,_settings.ID)),_addToDOM(_myDOMContent),NE.Plugin.LoadAll(_myDOMContent.first(),_pageOnLoad)})},AddPages:function(){for(var returnVal="",i=0;i<_settings.chapter.pages.length;i++){var page=NE.CourseTree.chapters[_settings.index].pages[i],dataFile=page.datafile;if(-1!=dataFile.indexOf("|")){NE.CourseTree.RandomSelectedPages||(NE.CourseTree.RandomSelectedPages=[]);var alts=_removeDuplicateRanPages(dataFile.split("|"));dataFile=alts[Math.floor(Math.random()*alts.length)],NE.CourseTree.RandomSelectedPages.push(dataFile)}var contentFile=NE.Constants.CONTENT_BASE_PATH+"/content/data/"+dataFile+".html";page.ID=NE.Constants.PAGE_ID_PREFIX+_settings.index+"-"+i,page.chapterIndex=_settings.index,page.index=i,page.datafile=contentFile,page.initclasses="NE-scroll-watched",returnVal+='<div class="NE-plugin-container" data-plugin="page" data-settings="'+escape(JSON.stringify(page))+'"></div>'}return returnVal},OnLoaded:function(){},eof:null};return me};